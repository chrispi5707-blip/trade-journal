<!DOCTYPE html>
<html><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trade Journal</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600;700&family=JetBrains+Mono:wght@600;700&display=swap" rel="stylesheet">
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0e17;color:#e0e6ed;font-family:'IBM Plex Sans',-apple-system,sans-serif}
input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none}
input[type=number]{-moz-appearance:textfield}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:#0a0e17}::-webkit-scrollbar-thumb{background:#1e2d3d;border-radius:3px}
</style>
</head><body>
<div id="root"></div>
<script>
try{
var h=React.createElement,us=React.useState,ue=React.useEffect,uc=React.useCallback,ur=React.useRef,um=React.useMemo;
var E={id:"",date:"",time:"",exitTime:"",direction:"L",type:"Rev",ticker:"TSLA",entry:"",stop:"",exit:"",shares:"",mfePrice:"",maePrice:"",adxAtEntry:"",cloudThickness:"",screenshotUrl:"",screenshotData:"",rules:{ultHL:"",lhHL:"",chanBreak:"",chanRetest:"",candleOff10:"",secondCandle:"",macdCross:"",cloudAlign:"",rsiExtreme:"",divPresent:"",cloud15m:""},stopMgmt:{initStop:"",stopChan:"",trailHL:"",stopMoved:"",reentry:""},exitType:"",rsiAtExit:"",volAtExit:"",notes:""};
var RL={ultHL:"Ultimate H/L",lhHL:"LH / HL",chanBreak:"Chan Break",chanRetest:"Chan Retest",candleOff10:"1st Candle 10EMA",secondCandle:"2nd Candle Entry",macdCross:"MACD Cross",cloudAlign:"Cloud Align",rsiExtreme:"RSI Extreme",divPresent:"Divergence",cloud15m:"15m Cloud"};
var SL={initStop:"Init Stop HL",stopChan:"Stop\u2192Chan",trailHL:"Trail H/L",stopMoved:"Stop Moved",reentry:"Re-entry"};
var K={bg:"#0a0e17",cd:"#0f1923",bd:"#1e2d3d",g:"#2ed573",r:"#ff4757",go:"#ffa502",cy:"#1e90ff",pu:"#a855f7",tx:"#e0e6ed",dm:"#6b7a8d",inp:"#1a2435"};
function gid(){return Date.now().toString(36)+Math.random().toString(36).slice(2,7)}
function dc(o){return JSON.parse(JSON.stringify(o))}
function cPL(t){if(!t.entry||!t.exit||!t.shares)return{pl:0,pp:0,rm:0};var e=+t.entry,x=+t.exit,s=+t.stop,sh=+t.shares;var pl=t.direction==="L"?(x-e)*sh:(e-x)*sh;var pp=t.direction==="L"?(x-e)/e:(e-x)/e;var rk=Math.abs(e-s);var rm=rk>0?(t.direction==="L"?(x-e)/rk:(e-x)/rk):0;return{pl:pl,pp:pp,rm:rm}}
function cMFE(t){if(!t.entry||!t.mfePrice)return null;var e=+t.entry,m=+t.mfePrice,x=t.exit?+t.exit:null;var md=t.direction==="L"?m-e:e-m;var ed=x?(t.direction==="L"?x-e:e-x):null;return{md:md,cp:ed!==null&&md>0?ed/md:null}}
function cMAE(t){if(!t.entry||!t.maePrice)return null;return{md:t.direction==="L"?+t.entry-+t.maePrice:+t.maePrice-+t.entry}}
function cDur(t){if(!t.time||!t.exitTime)return null;function tm(s){var p=s.split(":");return parseInt(p[0])*60+parseInt(p[1]||0)}var d=tm(t.exitTime)-tm(t.time);if(d<=0)return null;return{m:d,l:Math.floor(d/60)>0?Math.floor(d/60)+"h "+d%60+"m":d%60+"m"}}
function gs(a){if(!a.length)return{n:0,wr:0,ar:0,ap:0};var r=a.map(cPL),w=r.filter(function(x){return x.pl>0});return{n:a.length,wr:w.length/a.length,ar:r.reduce(function(s,x){return s+x.rm},0)/a.length,ap:r.reduce(function(s,x){return s+x.pl},0)/a.length}}

function Pl(p){return h("div",{style:{display:"flex",gap:2,background:K.bg,borderRadius:6,padding:2}},p.options.map(function(o){return h("button",{key:o.v,onClick:function(){p.onChange(o.v)},style:{padding:"4px 10px",borderRadius:5,border:"none",fontSize:11,fontWeight:600,cursor:"pointer",background:p.v===o.v?(o.c||K.cy):"transparent",color:p.v===o.v?"#fff":K.dm,transition:"all .15s"}},o.l)}))}
function YN(p){return h(Pl,{v:p.v,onChange:p.onChange,options:[{v:"Y",l:"Y",c:K.g},{v:"N",l:"N",c:K.r},{v:"",l:"-",c:K.dm}]})}
function Ip(p){return h("input",{type:p.type||"text",value:p.value||"",onChange:function(e){p.onChange(e.target.value)},placeholder:p.placeholder,step:p.step,style:Object.assign({background:K.inp,border:"1px solid "+K.bd,borderRadius:6,padding:"6px 10px",color:K.tx,fontSize:12,width:"100%",outline:"none"},p.style||{})})}
function SC(p){return h("div",{style:{background:K.cd,border:"1px solid "+K.bd,borderRadius:8,padding:"10px 14px",flex:1,minWidth:105}},h("div",{style:{fontSize:9,color:K.dm,marginBottom:3}},p.label),h("div",{style:{fontSize:17,fontWeight:700,color:p.color||K.tx,fontFamily:"JetBrains Mono,monospace"}},p.value),p.sub?h("div",{style:{fontSize:8,color:K.dm,marginTop:2}},p.sub):null)}

function App(){
var _t=us(function(){try{return JSON.parse(localStorage.getItem("tj3")||"[]")}catch(e){return[]}});
var trades=_t[0],setTr=_t[1];
var _v=us("log"),vw=_v[0],setVw=_v[1];
var _e=us(null),et=_e[0],setEt=_e[1];
var _sf=us(false),sf=_sf[0],setSf=_sf[1];
var _lb=us(null),lb=_lb[0],setLb=_lb[1];
var _fd=us("ALL"),fd=_fd[0],sFd=_fd[1];
var _ft=us("ALL"),ft=_ft[0],sFt=_ft[1];
var _fk=us("ALL"),fk=_fk[0],sFk=_fk[1];
var _qm=us(false),qm=_qm[0],sQm=_qm[1];
var fr=ur(null),ir=ur(null);

ue(function(){try{localStorage.setItem("tj3",JSON.stringify(trades))}catch(e){}},[trades]);

function mkN(){var t=dc(E);t.id=gid();t.date=new Date().toISOString().slice(0,10);return t}
function oN(){setEt(mkN());setSf(true);sQm(false)}
function oQ(){setEt(mkN());setSf(true);sQm(true)}
function oE(t){var c=dc(t);c.rules=Object.assign(dc(E.rules),c.rules||{});c.stopMgmt=Object.assign(dc(E.stopMgmt),c.stopMgmt||{});setEt(c);setSf(true);sQm(false)}
function sv(){if(!et)return;setTr(function(p){var i=-1;for(var j=0;j<p.length;j++)if(p[j].id===et.id){i=j;break}if(i>=0){var n=p.slice();n[i]=et;return n}return p.concat([et])});setSf(false);setEt(null)}
function dl(id){if(confirm("Delete?")){setTr(function(p){return p.filter(function(t){return t.id!==id})})}}
function hF(e){var f=e.target.files[0];if(!f)return;var r=new FileReader();r.onload=function(ev){setEt(function(p){var c=dc(p);c.screenshotData=ev.target.result;return c})};r.readAsDataURL(f)}
var hD=uc(function(e){e.preventDefault();var f=e.dataTransfer.files[0];if(!f||!f.type.startsWith("image/"))return;var r=new FileReader();r.onload=function(ev){setEt(function(p){var c=dc(p);c.screenshotData=ev.target.result;return c})};r.readAsDataURL(f)},[]);

var fl=um(function(){return trades.filter(function(t){if(fd!=="ALL"&&t.direction!==fd)return false;if(ft!=="ALL"&&t.type!==ft)return false;if(fk!=="ALL"&&t.ticker!==fk)return false;return true}).sort(function(a,b){return(b.date+b.time).localeCompare(a.date+a.time)})},[trades,fd,ft,fk]);
var tks=um(function(){var s={};trades.forEach(function(t){if(t.ticker)s[t.ticker]=1});return Object.keys(s)},[trades]);
var cp=um(function(){return trades.filter(function(t){return t.entry&&t.exit&&t.shares})},[trades]);

var st=um(function(){var t=fl.filter(function(x){return x.entry&&x.exit&&x.shares});if(!t.length)return null;
var rs=t.map(function(x){var p=cPL(x);return{pl:p.pl,rm:p.rm,mfe:cMFE(x),dur:cDur(x)}});
var w=rs.filter(function(r){return r.pl>0}),l=rs.filter(function(r){return r.pl<0});
var ds=rs.map(function(r){return r.dur}).filter(Boolean);
var cs=rs.map(function(r){return r.mfe&&r.mfe.cp}).filter(function(c){return c!=null});
return{n:rs.length,w:w.length,l:l.length,wr:w.length/rs.length,
tp:rs.reduce(function(s,r){return s+r.pl},0),
aw:w.length?w.reduce(function(s,r){return s+r.pl},0)/w.length:0,
al:l.length?l.reduce(function(s,r){return s+r.pl},0)/l.length:0,
ar:rs.reduce(function(s,r){return s+r.rm},0)/rs.length,
pf:l.length?Math.abs(w.reduce(function(s,r){return s+r.pl},0)/l.reduce(function(s,r){return s+r.pl},0)):w.length?999:0,
ad:ds.length?ds.reduce(function(s,d){return s+d.m},0)/ds.length:null,
ac:cs.length?cs.reduce(function(s,c){return s+c},0)/cs.length:null}},[fl]);

var ra=um(function(){if(!cp.length)return[];
var out=Object.keys(RL).map(function(k){var wi=cp.filter(function(t){return t.rules[k]==="Y"}),wo=cp.filter(function(t){return t.rules[k]==="N"});return{key:k,label:RL[k],w:gs(wi),wo:gs(wo),edge:gs(wi).wr-gs(wo).wr,type:"yn"}});
var at=cp.filter(function(t){return t.adxAtEntry});
if(at.length>=3)out.push({key:"adx",label:"ADX at Entry",type:"num",edge:0,bk:[{l:"< 20 (Weak)",s:gs(at.filter(function(t){return+t.adxAtEntry<20}))},{l:"20-25",s:gs(at.filter(function(t){var v=+t.adxAtEntry;return v>=20&&v<25}))},{l:"25+ (Strong)",s:gs(at.filter(function(t){return+t.adxAtEntry>=25}))}]});
var ct=cp.filter(function(t){return t.cloudThickness});
if(ct.length>=3)out.push({key:"cl",label:"Cloud Width %",type:"num",edge:0,bk:[{l:"< 0.15% (Thin)",s:gs(ct.filter(function(t){return+t.cloudThickness<0.15}))},{l:"0.15-0.35%",s:gs(ct.filter(function(t){var v=+t.cloudThickness;return v>=0.15&&v<0.35}))},{l:"0.35%+ (Thick)",s:gs(ct.filter(function(t){return+t.cloudThickness>=0.35}))}]});
var dt=cp.filter(function(t){return cDur(t)});
if(dt.length>=3)out.push({key:"dur",label:"Duration",type:"num",edge:0,bk:[{l:"< 10m",s:gs(dt.filter(function(t){return cDur(t).m<10}))},{l:"10-30m",s:gs(dt.filter(function(t){var m=cDur(t).m;return m>=10&&m<30}))},{l:"30m+",s:gs(dt.filter(function(t){return cDur(t).m>=30}))}]});
return out.sort(function(a,b){if(a.type==="num"&&b.type!=="num")return 1;if(b.type==="num"&&a.type!=="num")return-1;return Math.abs(b.edge)-Math.abs(a.edge)})},[cp]);

// FORM
function rF(){if(!et)return null;var t=et;
function u(k,v){setEt(function(p){var c=dc(p);c[k]=v;return c})}
function uR(k,v){setEt(function(p){var c=dc(p);c.rules[k]=v;return c})}
function uS(k,v){setEt(function(p){var c=dc(p);c.stopMgmt[k]=v;return c})}
var img=t.screenshotData||t.screenshotUrl;
var pp=(t.entry&&t.exit&&t.shares)?cPL(t):null;
var mf=(t.entry&&t.mfePrice)?cMFE(t):null;
var ma=(t.entry&&t.maePrice)?cMAE(t):null;
var du=cDur(t);
var pv=[];
if(pp){pv.push(h("div",{key:"pl",style:{flex:1,textAlign:"center",minWidth:65}},h("div",{style:{fontSize:8,color:K.dm}},"P/L"),h("div",{style:{fontSize:14,fontWeight:700,color:pp.pl>=0?K.g:K.r,fontFamily:"JetBrains Mono,monospace"}},"$"+pp.pl.toFixed(2))));pv.push(h("div",{key:"r",style:{flex:1,textAlign:"center",minWidth:65}},h("div",{style:{fontSize:8,color:K.dm}},"R"),h("div",{style:{fontSize:14,fontWeight:700,color:pp.rm>=0?K.g:K.r,fontFamily:"JetBrains Mono,monospace"}},pp.rm.toFixed(2)+"R")))}
if(du)pv.push(h("div",{key:"d",style:{flex:1,textAlign:"center",minWidth:65}},h("div",{style:{fontSize:8,color:K.dm}},"Duration"),h("div",{style:{fontSize:14,fontWeight:700,color:K.go,fontFamily:"JetBrains Mono,monospace"}},du.l)));
if(mf&&mf.cp!==null)pv.push(h("div",{key:"c",style:{flex:1,textAlign:"center",minWidth:65}},h("div",{style:{fontSize:8,color:K.dm}},"Captured"),h("div",{style:{fontSize:14,fontWeight:700,color:mf.cp>=.7?K.g:mf.cp>=.5?K.go:K.r,fontFamily:"JetBrains Mono,monospace"}},(mf.cp*100).toFixed(0)+"%")));
if(ma)pv.push(h("div",{key:"m",style:{flex:1,textAlign:"center",minWidth:65}},h("div",{style:{fontSize:8,color:K.dm}},"Drawdown"),h("div",{style:{fontSize:14,fontWeight:700,color:K.r,fontFamily:"JetBrains Mono,monospace"}},"-$"+ma.md.toFixed(2))));
var re=Object.keys(RL).map(function(k){return h("div",{key:k,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"3px 7px",background:K.bg,borderRadius:6}},h("span",{style:{fontSize:9,color:K.dm}},RL[k]),h(YN,{v:t.rules[k],onChange:function(v){uR(k,v)}}))});
var se=Object.keys(SL).map(function(k){return h("div",{key:k,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"3px 7px",background:K.bg,borderRadius:6}},h("span",{style:{fontSize:9,color:K.dm}},SL[k]),h(YN,{v:t.stopMgmt[k],onChange:function(v){uS(k,v)}}))});
var qe=["macdCross","divPresent","rsiExtreme","cloudAlign","chanRetest","cloud15m"].map(function(k){return h("div",{key:k,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"3px 7px",background:K.bg,borderRadius:6}},h("span",{style:{fontSize:9,color:K.dm}},RL[k]),h(YN,{v:t.rules[k],onChange:function(v){uR(k,v)}}))});
return h("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,.85)",zIndex:1000,overflow:"auto",padding:"16px 8px"}},
h("div",{style:{maxWidth:qm?560:840,margin:"0 auto",background:K.cd,borderRadius:12,border:"1px solid "+K.bd,padding:22}},
h("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14}},h("h2",{style:{color:K.go,fontSize:16,margin:0,fontFamily:"JetBrains Mono,monospace"}},qm?"QUICK ENTRY":"TRADE ENTRY"),h("div",{style:{display:"flex",gap:6}},h("button",{onClick:function(){sQm(!qm)},style:{padding:"5px 10px",background:qm?K.cy:K.pu,border:"none",borderRadius:6,color:"#fff",fontSize:10,cursor:"pointer"}},qm?"Full":"Quick"),h("button",{onClick:function(){setSf(false);setEt(null)},style:{padding:"5px 10px",background:K.r,border:"none",borderRadius:6,color:"#fff",fontSize:10,cursor:"pointer"}},"Cancel"))),
h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8,marginBottom:10}},h("div",null,h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"Date"),h(Ip,{value:t.date,onChange:function(v){u("date",v)},type:"date"})),h("div",null,h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"Entry Time"),h(Ip,{value:t.time,onChange:function(v){u("time",v)},placeholder:"10:32"})),h("div",null,h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"Exit Time"),h(Ip,{value:t.exitTime,onChange:function(v){u("exitTime",v)},placeholder:"10:47"})),h("div",null,h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"Ticker"),h(Ip,{value:t.ticker,onChange:function(v){u("ticker",v.toUpperCase())},placeholder:"TSLA"}))),
h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10,marginBottom:10}},h("div",null,h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"Direction"),h(Pl,{v:t.direction,onChange:function(v){u("direction",v)},options:[{v:"L",l:"LONG",c:K.g},{v:"S",l:"SHORT",c:K.r}]})),h("div",null,h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"Type"),h(Pl,{v:t.type,onChange:function(v){u("type",v)},options:[{v:"Rev",l:"Reversal",c:K.cy},{v:"Cont",l:"Continuation",c:K.go}]}))),
h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8,marginBottom:10}},h("div",null,h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"Entry $"),h(Ip,{value:t.entry,onChange:function(v){u("entry",v)},placeholder:"452.30",type:"number",step:"0.01"})),h("div",null,h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"Stop $"),h(Ip,{value:t.stop,onChange:function(v){u("stop",v)},placeholder:"451.10",type:"number",step:"0.01"})),h("div",null,h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"Exit $"),h(Ip,{value:t.exit,onChange:function(v){u("exit",v)},placeholder:"454.80",type:"number",step:"0.01"})),h("div",null,h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"Shares"),h(Ip,{value:t.shares,onChange:function(v){u("shares",v)},placeholder:"400",type:"number"}))),
h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:8,marginBottom:10}},h("div",null,h("div",{style:{fontSize:9,color:K.cy,marginBottom:2}},"Best Price (MFE)"),h(Ip,{value:t.mfePrice,onChange:function(v){u("mfePrice",v)},placeholder:t.direction==="L"?"High":"Low",type:"number",step:"0.01"})),h("div",null,h("div",{style:{fontSize:9,color:K.r,marginBottom:2}},"Worst Price (MAE)"),h(Ip,{value:t.maePrice,onChange:function(v){u("maePrice",v)},placeholder:t.direction==="L"?"Low dip":"High spike",type:"number",step:"0.01"})),h("div",null,h("div",{style:{fontSize:9,color:K.go,marginBottom:2}},"ADX at Entry"),h(Ip,{value:t.adxAtEntry,onChange:function(v){u("adxAtEntry",v)},placeholder:"25.3",type:"number",step:"0.1"})),h("div",null,h("div",{style:{fontSize:9,color:K.pu,marginBottom:2}},"Cloud Width % at Entry"),h(Ip,{value:t.cloudThickness,onChange:function(v){u("cloudThickness",v)},placeholder:"0.25",type:"number",step:"0.01"}))),
pv.length?h("div",{style:{display:"flex",gap:6,marginBottom:12,padding:8,background:K.bg,borderRadius:8,flexWrap:"wrap"}},pv):null,
h("div",{style:{marginBottom:12}},h("div",{style:{fontSize:10,color:K.dm,marginBottom:4,fontWeight:600}},"SCREENSHOT"),h("div",{style:{display:"flex",gap:6,marginBottom:4}},h(Ip,{value:t.screenshotUrl,onChange:function(v){u("screenshotUrl",v)},placeholder:"Paste TradingView URL...",style:{flex:1}}),h("button",{onClick:function(){fr.current&&fr.current.click()},style:{padding:"5px 12px",background:K.cy,border:"none",borderRadius:6,color:"#fff",fontSize:10,cursor:"pointer"}},"Upload"),h("input",{ref:fr,type:"file",accept:"image/*",onChange:hF,style:{display:"none"}})),h("div",{onDrop:hD,onDragOver:function(e){e.preventDefault()},style:{border:"2px dashed "+K.bd,borderRadius:8,padding:img?4:16,textAlign:"center",color:K.dm,fontSize:10,cursor:"pointer",minHeight:img?40:50,display:"flex",alignItems:"center",justifyContent:"center",background:K.bg}},img?h("img",{src:img,alt:"",onClick:function(){setLb(img)},style:{maxWidth:"100%",maxHeight:160,borderRadius:6,cursor:"zoom-in"}}):"Drag & drop screenshot here")),
!qm?h("div",null,h("div",{style:{fontSize:10,color:K.go,marginBottom:6,fontWeight:700}},"SETUP RULES"),h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:5,marginBottom:12}},re),h("div",{style:{fontSize:10,color:K.r,marginBottom:6,fontWeight:700}},"STOP MANAGEMENT"),h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:5,marginBottom:12}},se),h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:12}},h("div",null,h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"Exit Type"),h(Pl,{v:t.exitType,onChange:function(v){u("exitType",v)},options:[{v:"Trail",l:"Trail",c:K.g},{v:"Limit",l:"Limit",c:K.go},{v:"Stop",l:"Stopped",c:K.r}]})),h("div",null,h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"RSI at Exit"),h(Ip,{value:t.rsiAtExit,onChange:function(v){u("rsiAtExit",v)},placeholder:"78.5"})),h("div",null,h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"Vol at Exit"),h(Ip,{value:t.volAtExit,onChange:function(v){u("volAtExit",v)},placeholder:"H / M / L"}))),h("div",{style:{marginBottom:12}},h("div",{style:{fontSize:9,color:K.dm,marginBottom:2}},"Notes"),h(Ip,{value:t.notes,onChange:function(v){u("notes",v)},placeholder:"Trade notes..."}))):null,
qm?h("div",{style:{marginBottom:12}},h("div",{style:{fontSize:10,color:K.go,marginBottom:6,fontWeight:700}},"QUICK RULES"),h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:5}},qe)):null,
h("button",{onClick:sv,style:{width:"100%",padding:"11px",background:K.g,border:"none",borderRadius:8,color:"#000",fontSize:13,fontWeight:700,cursor:"pointer"}},"SAVE TRADE")))}

// LOG
function rL(){
var rows=fl.map(function(t){var p=cPL(t),mfe=cMFE(t),dur=cDur(t),img=t.screenshotData||t.screenshotUrl,w=p.pl>0;
var mi=[h("span",{key:"e"},"E:"+t.entry),h("span",{key:"x"},"X:"+t.exit),h("span",{key:"s"},"\u00d7"+t.shares)];
if(dur)mi.push(h("span",{key:"d",style:{color:K.go}},dur.l));
if(mfe&&mfe.cp!==null)mi.push(h("span",{key:"c",style:{color:mfe.cp>=.7?K.g:K.go}},(mfe.cp*100).toFixed(0)+"%cap"));
if(t.adxAtEntry)mi.push(h("span",{key:"a",style:{color:+t.adxAtEntry>=25?K.g:K.go}},"ADX:"+t.adxAtEntry));
if(t.cloudThickness)mi.push(h("span",{key:"cl",style:{color:K.pu}},"CW:"+t.cloudThickness+"%"));
return h("div",{key:t.id,onClick:function(){oE(t)},style:{display:"flex",alignItems:"center",gap:8,padding:"7px 10px",background:K.cd,borderRadius:8,border:"1px solid "+K.bd,borderLeft:"3px solid "+(w?K.g:p.pl<0?K.r:K.bd),cursor:"pointer"}},
h("div",{style:{width:42,height:30,borderRadius:4,overflow:"hidden",flexShrink:0,background:K.bg,display:"flex",alignItems:"center",justifyContent:"center"}},img?h("img",{src:img,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"},onClick:function(e){e.stopPropagation();setLb(img)}}):h("span",{style:{fontSize:7,color:K.dm}},"\u2014")),
h("div",{style:{minWidth:38,textAlign:"center"}},h("span",{style:{fontSize:10,fontWeight:700,color:t.direction==="L"?K.g:K.r,fontFamily:"JetBrains Mono,monospace"}},t.direction==="L"?"LONG":"SHORT"),h("div",{style:{fontSize:7,color:K.dm}},t.type)),
h("div",{style:{minWidth:42}},h("div",{style:{fontSize:10,fontWeight:600,color:K.tx}},t.ticker),h("div",{style:{fontSize:8,color:K.dm}},t.date)),
h("div",{style:{flex:1,display:"flex",gap:10,alignItems:"center",fontSize:9,fontFamily:"JetBrains Mono,monospace",color:K.dm,flexWrap:"wrap"}},mi),
h("div",{style:{textAlign:"right",minWidth:70}},h("div",{style:{fontSize:13,fontWeight:700,color:w?K.g:p.pl<0?K.r:K.dm,fontFamily:"JetBrains Mono,monospace"}},"$"+p.pl.toFixed(2)),h("div",{style:{fontSize:8,color:w?K.g:p.pl<0?K.r:K.dm}},p.rm.toFixed(2)+"R")),
h("button",{onClick:function(e){e.stopPropagation();dl(t.id)},style:{padding:"2px 6px",background:"transparent",border:"1px solid "+K.bd,borderRadius:4,color:K.r,fontSize:9,cursor:"pointer"}},"\u00d7"))});
var sc=[];
if(st){sc.push(h(SC,{key:"wr",label:"Win Rate",value:(st.wr*100).toFixed(1)+"%",color:st.wr>=.5?K.g:K.r,sub:st.w+"W / "+st.l+"L"}));sc.push(h(SC,{key:"tp",label:"Total P/L",value:"$"+st.tp.toFixed(0),color:st.tp>=0?K.g:K.r}));sc.push(h(SC,{key:"ar",label:"Avg R",value:st.ar.toFixed(2)+"R",color:st.ar>=0?K.g:K.r}));sc.push(h(SC,{key:"pf",label:"PF",value:st.pf>=999?"\u221e":st.pf.toFixed(2),color:st.pf>=1.5?K.g:st.pf>=1?K.go:K.r}));sc.push(h(SC,{key:"aw",label:"Avg Win",value:"$"+st.aw.toFixed(0),color:K.g,sub:"Loss: $"+st.al.toFixed(0)}));if(st.ad!==null)sc.push(h(SC,{key:"ad",label:"Avg Duration",value:st.ad.toFixed(0)+"m",color:K.go}));if(st.ac!==null)sc.push(h(SC,{key:"ac",label:"Avg Capture",value:(st.ac*100).toFixed(0)+"%",color:st.ac>=.7?K.g:st.ac>=.5?K.go:K.r,sub:"of max move"}))}
return h("div",null,
h("div",{style:{display:"flex",gap:6,marginBottom:12,flexWrap:"wrap",alignItems:"center"}},h(Pl,{v:fd,onChange:sFd,options:[{v:"ALL",l:"All"},{v:"L",l:"Longs",c:K.g},{v:"S",l:"Shorts",c:K.r}]}),h(Pl,{v:ft,onChange:sFt,options:[{v:"ALL",l:"All"},{v:"Rev",l:"Rev",c:K.cy},{v:"Cont",l:"Cont",c:K.go}]}),tks.length>1?h("select",{value:fk,onChange:function(e){sFk(e.target.value)},style:{background:K.inp,border:"1px solid "+K.bd,borderRadius:6,padding:"4px 8px",color:K.tx,fontSize:10}},[h("option",{key:"ALL",value:"ALL"},"All Tickers")].concat(tks.map(function(t){return h("option",{key:t,value:t},t)}))):null,h("div",{style:{flex:1}}),h("span",{style:{fontSize:10,color:K.dm}},fl.length+" trades")),
sc.length?h("div",{style:{display:"flex",gap:6,marginBottom:12,flexWrap:"wrap"}},sc):null,
h("div",{style:{display:"flex",flexDirection:"column",gap:4}},rows),
!fl.length?h("div",{style:{textAlign:"center",padding:40,color:K.dm}},"No trades yet. Click '+ New Trade' to start."):null)}

// RULES
function rR(){
var items=ra.map(function(r){
if(r.type==="num")return h("div",{key:r.key,style:{background:K.cd,borderRadius:8,border:"1px solid "+K.bd,padding:"12px 14px"}},h("div",{style:{fontSize:12,fontWeight:600,color:K.pu,marginBottom:8}},r.label+" \u2014 Buckets"),h("div",{style:{display:"flex",gap:10,flexWrap:"wrap"}},r.bk.map(function(b,i){return h("div",{key:i,style:{flex:1,minWidth:130,padding:8,background:K.bg,borderRadius:6}},h("div",{style:{fontSize:10,fontWeight:600,color:K.tx,marginBottom:4}},b.l),h("div",{style:{fontSize:9,color:K.dm,lineHeight:"1.9"}},b.s.n+" trades | ",h("span",{style:{color:b.s.wr>=.5?K.g:K.r,fontWeight:600}},(b.s.wr*100).toFixed(1)+"% WR")," | ",h("span",{style:{color:b.s.ar>=0?K.g:K.r}},b.s.ar.toFixed(2)+"R")," | ",h("span",{style:{color:b.s.ap>=0?K.g:K.r}},"$"+b.s.ap.toFixed(0))),h("div",{style:{height:4,background:K.bd,borderRadius:2,marginTop:4,overflow:"hidden"}},h("div",{style:{height:"100%",width:b.s.wr*100+"%",background:b.s.wr>=.5?K.g:K.r,borderRadius:2}})))})));
var ep=(r.edge*100).toFixed(1);
return h("div",{key:r.key,style:{background:K.cd,borderRadius:8,border:"1px solid "+K.bd,padding:"10px 14px"}},h("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}},h("span",{style:{fontSize:12,fontWeight:600,color:K.tx}},r.label),h("span",{style:{fontSize:13,fontWeight:700,color:r.edge>.05?K.g:r.edge<-.05?K.r:K.dm,fontFamily:"JetBrains Mono,monospace"}},(r.edge>0?"+":"")+ep+"% edge")),h("div",{style:{display:"flex",gap:14,fontSize:10}},h("div",{style:{flex:1}},h("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3}},h("span",{style:{color:K.g}},"Y: "+r.w.n),h("span",{style:{color:K.g,fontFamily:"JetBrains Mono,monospace"}},(r.w.wr*100).toFixed(1)+"% \u00b7 "+r.w.ar.toFixed(2)+"R \u00b7 $"+r.w.ap.toFixed(0))),h("div",{style:{height:3,background:K.bg,borderRadius:2,overflow:"hidden"}},h("div",{style:{height:"100%",width:r.w.wr*100+"%",background:K.g,borderRadius:2}}))),h("div",{style:{flex:1}},h("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:3}},h("span",{style:{color:K.r}},"N: "+r.wo.n),h("span",{style:{color:K.r,fontFamily:"JetBrains Mono,monospace"}},(r.wo.wr*100).toFixed(1)+"% \u00b7 "+r.wo.ar.toFixed(2)+"R \u00b7 $"+r.wo.ap.toFixed(0))),h("div",{style:{height:3,background:K.bg,borderRadius:2,overflow:"hidden"}},h("div",{style:{height:"100%",width:r.wo.wr*100+"%",background:K.r,borderRadius:2}})))))});
return h("div",null,h("div",{style:{fontSize:11,color:K.dm,marginBottom:12}},"Y/N rules sorted by edge. Numeric fields show bucket breakdowns."),!ra.length?h("div",{style:{textAlign:"center",padding:40,color:K.dm}},"Log trades with rules to see analysis."):h("div",{style:{display:"flex",flexDirection:"column",gap:8}},items))}

// EQUITY - simple CSS bars instead of Recharts
function rEq(){
if(!cp.length)return h("div",{style:{textAlign:"center",padding:40,color:K.dm}},"Log completed trades to see equity data.");
var sorted=cp.slice().sort(function(a,b){return(a.date+a.time).localeCompare(b.date+b.time)});
var cum=0,maxCum=0,minCum=0;
var pts=sorted.map(function(t,i){var p=cPL(t);cum+=p.pl;if(cum>maxCum)maxCum=cum;if(cum<minCum)minCum=cum;return{i:i+1,pl:p.pl,cum:cum,tk:t.ticker,mfe:cMFE(t)}});
var range=Math.max(maxCum-minCum,1);
var maxPL=Math.max.apply(null,pts.map(function(p){return Math.abs(p.pl)}));if(maxPL<1)maxPL=1;
return h("div",null,
h("div",{style:{background:K.cd,borderRadius:8,border:"1px solid "+K.bd,padding:14,marginBottom:12}},h("div",{style:{fontSize:11,color:K.dm,marginBottom:8}},"CUMULATIVE P/L"),h("div",{style:{fontSize:20,fontWeight:700,color:cum>=0?K.g:K.r,fontFamily:"JetBrains Mono,monospace",marginBottom:10}},"$"+cum.toFixed(2)),h("div",{style:{display:"flex",alignItems:"flex-end",gap:2,height:120}},pts.map(function(p){var pct=(p.cum-minCum)/range*100;return h("div",{key:p.i,title:"Trade #"+p.i+": $"+p.cum.toFixed(2),style:{flex:1,background:p.cum>=0?K.g:K.r,height:Math.max(pct,2)+"%",borderRadius:"2px 2px 0 0",minWidth:2,opacity:.8}})}))),
h("div",{style:{background:K.cd,borderRadius:8,border:"1px solid "+K.bd,padding:14,marginBottom:12}},h("div",{style:{fontSize:11,color:K.dm,marginBottom:8}},"PER-TRADE P/L"),h("div",{style:{display:"flex",alignItems:"center",gap:2,height:100}},pts.map(function(p){var pct=Math.abs(p.pl)/maxPL*100;return h("div",{key:p.i,title:"#"+p.i+" "+p.tk+": $"+p.pl.toFixed(2),style:{flex:1,minWidth:2,alignSelf:p.pl>=0?"flex-end":"flex-start",background:p.pl>=0?K.g:K.r,height:Math.max(pct,3)+"%",borderRadius:2,opacity:.85}})}))),
pts.some(function(p){return p.mfe&&p.mfe.cp!==null})?h("div",{style:{background:K.cd,borderRadius:8,border:"1px solid "+K.bd,padding:14}},h("div",{style:{fontSize:11,color:K.dm,marginBottom:8}},"MOVE CAPTURE %"),h("div",{style:{display:"flex",alignItems:"flex-end",gap:3,height:100}},pts.filter(function(p){return p.mfe&&p.mfe.cp!==null}).map(function(p,i){var cp=p.mfe.cp*100;return h("div",{key:i,title:p.tk+": "+cp.toFixed(1)+"%",style:{flex:1,minWidth:8,background:cp>=70?K.g:cp>=50?K.go:K.r,height:Math.min(cp,100)+"%",borderRadius:"2px 2px 0 0",opacity:.85}})}))):null)}

function expJ(){var b=new Blob([JSON.stringify(trades,null,2)],{type:"application/json"});var u=URL.createObjectURL(b);var a=document.createElement("a");a.href=u;a.download="trade_journal_"+new Date().toISOString().slice(0,10)+".json";a.click();URL.revokeObjectURL(u)}
function impJ(e){var f=e.target.files[0];if(!f)return;var r=new FileReader();r.onload=function(ev){try{var d=JSON.parse(ev.target.result);if(Array.isArray(d))setTr(d)}catch(err){alert("Bad JSON")}};r.readAsText(f)}

// Lightbox
if(lb)return h("div",null,h("div",{onClick:function(){setLb(null)},style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,.92)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",cursor:"zoom-out"}},h("img",{src:lb,alt:"",style:{maxWidth:"94vw",maxHeight:"94vh",borderRadius:8}}),h("div",{style:{position:"absolute",top:16,right:24,color:"#fff",fontSize:28,cursor:"pointer",fontWeight:700}},"\u00d7")));

return h("div",{style:{background:K.bg,minHeight:"100vh",color:K.tx,fontFamily:"'IBM Plex Sans',-apple-system,sans-serif"}},
sf?rF():null,
h("div",{style:{padding:"10px 14px",borderBottom:"1px solid "+K.bd,display:"flex",alignItems:"center",gap:10,flexWrap:"wrap"}},
h("h1",{style:{margin:0,fontSize:15,fontFamily:"JetBrains Mono,monospace",color:K.go}},"TRADE JOURNAL"),
h("div",{style:{display:"flex",gap:2,background:K.cd,borderRadius:8,padding:2}},[["log","Trade Log"],["rules","Rule Analysis"],["equity","Equity / MFE"]].map(function(x){return h("button",{key:x[0],onClick:function(){setVw(x[0])},style:{padding:"5px 11px",borderRadius:6,border:"none",fontSize:10,fontWeight:600,cursor:"pointer",background:vw===x[0]?K.cy:"transparent",color:vw===x[0]?"#fff":K.dm}},x[1])})),
h("div",{style:{flex:1}}),
h("button",{onClick:oQ,style:{padding:"6px 12px",background:K.pu,border:"none",borderRadius:8,color:"#fff",fontSize:10,fontWeight:600,cursor:"pointer"}},"Quick Entry"),
h("button",{onClick:oN,style:{padding:"6px 12px",background:K.g,border:"none",borderRadius:8,color:"#000",fontSize:10,fontWeight:600,cursor:"pointer"}},"+ New Trade"),
h("div",{style:{display:"flex",gap:3}},h("button",{onClick:expJ,style:{padding:"4px 8px",background:"transparent",border:"1px solid "+K.bd,borderRadius:6,color:K.dm,fontSize:9,cursor:"pointer"}},"Export"),h("button",{onClick:function(){ir.current&&ir.current.click()},style:{padding:"4px 8px",background:"transparent",border:"1px solid "+K.bd,borderRadius:6,color:K.dm,fontSize:9,cursor:"pointer"}},"Import"),h("input",{ref:ir,type:"file",accept:".json",onChange:impJ,style:{display:"none"}}))),
h("div",{style:{padding:14,maxWidth:1200,margin:"0 auto"}},vw==="log"?rL():null,vw==="rules"?rR():null,vw==="equity"?rEq():null))}

ReactDOM.createRoot(document.getElementById("root")).render(h(App));
}catch(err){document.getElementById("root").innerHTML='<div style="color:#ff4757;padding:20px;font-family:monospace">Error: '+err.message+'<br>Line: '+err.stack+'</div>'}
</script>
</body></html>
